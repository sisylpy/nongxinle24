<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.nongxinle.dao.GbDepartmentBillDao">

    <select id="queryObject" resultType="com.nongxinle.entity.GbDepartmentBillEntity">
        select *
        from gb_department_bill
        where gb_department_bill_id = #{value}
    </select>

    <select id="queryList" resultType="com.nongxinle.entity.GbDepartmentBillEntity">
        select * from gb_department_bill
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>

    <select id="queryTotal" resultType="int">
        select count(*)
        from gb_department_bill
    </select>

    <resultMap id="fatherDep" type="GbDepartmentEntity">
        <id property="gbDepartmentId" column="f_gb_department_id"/>
        <result property="gbDepartmentName" column="f_gb_department_name"/>
        <result property="gbDepartmentAttrName" column="f_gb_department_attr_name"/>
        <result property="gbDepartmentDisId" column="f_gb_department_dis_id"/>
        <result property="gbDepartmentSubAmount" column="f_gb_department_sub_amount"/>
        <result property="gbDepartmentIsGroupDep" column="f_gb_department_is_group_dep"/>
        <result property="gbDepartmentSubAmount" column="f_gb_department_sub_amount"/>
        <result property="gbDepartmentFatherId" column="f_gb_department_father_id"/>
        <result property="gbDepartmentSettleType" column="f_gb_department_settle_type"/>
        <result property="gbDepartmentType" column="f_gb_department_type"/>
    </resultMap>
    <resultMap id="issueDep" type="GbDepartmentEntity">
        <id property="gbDepartmentId" column="gb_department_id"/>
		<result property="gbDepartmentNamePy" column="gb_department_name_py"/>
        <result property="gbDepartmentName" column="gb_department_name"/>
        <result property="gbDepartmentAttrName" column="gb_department_attr_name"/>
        <result property="gbDepartmentDisId" column="gb_department_dis_id"/>
        <result property="gbDepartmentSubAmount" column="gb_department_sub_amount"/>
        <result property="gbDepartmentIsGroupDep" column="gb_department_is_group_dep"/>
        <result property="gbDepartmentSubAmount" column="gb_department_sub_amount"/>
        <result property="gbDepartmentFatherId" column="gb_department_father_id"/>
        <result property="gbDepartmentSettleType" column="gb_department_settle_type"/>
        <result property="gbDepartmentType" column="gb_department_type"/>
        <result property="gbDepartmentLevel" column="gb_department_level"/>
        <result property="gbDepartmentPrintName" column="gb_department_print_name"/>
    </resultMap>


    <resultMap id="disGoods" type="GbDistributerGoodsEntity">
        <id property="gbDistributerGoodsId" column="gb_distributer_goods_id"/>
		<result property="gbDgGbDepartmentId" column="gb_dg_gb_department_id"/>
		<result property="gbDgGoodsIsHidden" column="gb_dg_goods_is_hidden"/>
		<result property="gbDgGoodsSonsSort" column="gb_dg_goods_sons_sort"/>
        <result property="gbDgSellingPrice" column="gb_dg_selling_price"/>
        <result property="gbDgSellingPrice" column="gb_dg_selling_price"/>
        <result property="gbDgGoodsName" column="gb_dg_goods_name"/>
        <result property="gbDgGoodsStandardname" column="gb_dg_goods_standardname"/>
        <result property="gbDgGoodsStandardWeight" column="gb_dg_goods_standard_weight"/>
        <result property="gbDgGoodsBrand" column="gb_dg_goods_brand"/>
        <result property="gbDgGoodsDetail" column="gb_dg_goods_detail"/>
        <result property="gbDgGoodsPlace" column="gb_dg_goods_place"/>
        <result property="gbDgGoodsIsWeight" column="gb_dg_goods_is_weight"/>
        <result property="gbDgDfgGoodsFatherId" column="gb_dg_dfg_goods_father_id"/>
        <result property="gbDgGoodsPrice" column="gb_dg_goods_price"/>
        <result property="gbDgGoodsLowestPrice" column="gb_dg_goods_lowest_price"/>
        <result property="gbDgGoodsHighestPrice" column="gb_dg_goods_highest_price"/>
        <result property="gbDgControlPrice" column="gb_dg_control_price"/>
        <result property="gbDgControlFresh" column="gb_dg_control_fresh"/>
        <result property="gbDgFreshWarnHour" column="gb_dg_fresh_warn_hour"/>
        <result property="gbDgFreshWasteHour" column="gb_dg_fresh_waste_hour"/>
        <result property="gbDgGoodsInventoryType" column="gb_dg_goods_inventory_type"/>
        <result property="gbDgIsFranchisePrice" column="gb_dg_is_franchise_price"/>
        <result property="gbDgFranchisePriceOne" column="gb_dg_franchise_price_one"/>
        <result property="gbDgFranchisePriceOneUpdate" column="gb_dg_franchise_price_one_update"/>
        <result property="gbDgFranchisePriceTwo" column="gb_dg_franchise_price_two"/>
        <result property="gbDgFranchisePriceTwoUpdate" column="gb_dg_franchise_price_two_update"/>
        <result property="gbDgFranchisePriceThree" column="gb_dg_franchise_price_three"/>
        <result property="gbDgFranchisePriceThreeUpdate" column="gb_dg_franchise_price_three_update"/>
        <result property="gbDgIsSelfControl" column="gb_dg_is_self_control"/>
        <result property="gbDgSelfPrice" column="gb_dg_self_price"/>
    </resultMap>


    <resultMap id="depStock" type="GbDepartmentGoodsStockEntity">

        <id property="gbDepartmentGoodsStockId" column="gb_department_goods_stock_id"/>
        <result property="gbDgsProduceSellingSubtotal" column="gb_dgs_produce_selling_subtotal"/>
        <result property="gbDgsNxDistributerId" column="gb_dgs_nx_distributer_id"/>
        <result property="gbDgsNxDistributerId" column="gb_dgs_nx_distributer_id"/>
        <result property="gbDgsSellingPrice" column="gb_dgs_selling_price"/>
        <result property="gbDgsSellingSubtotal" column="gb_dgs_selling_subtotal"/>
        <result property="gbDgsAfterProfitSubtotal" column="gb_dgs_after_profit_subtotal"/>
        <result property="gbDgsBetweenPrice" column="gb_dgs_between_price"/>
        <result property="gbDgsProfitWeight" column="gb_dgs_profit_weight"/>
        <result property="gbDgsProfitSubtotal" column="gb_dgs_profit_subtotal"/>
        <result property="gbDgsSellingPrice" column="gb_dgs_selling_price"/>
        <result property="gbDgsSellingSubtotal" column="gb_dgs_selling_subtotal"/>
        <result property="gbDgsRestWeightShowStandard" column="gb_dgs_rest_weight_show_standard"/>
        <result property="gbDgsRestWeightShowStandardName" column="gb_dgs_rest_weight_show_standard_name"/>
        <result property="gbDgsGbDisGoodsId" column="gb_dgs_gb_dis_goods_id"/>
        <result property="gbDgsGbDisGoodsFatherId" column="gb_dgs_gb_dis_goods_father_id"/>
        <result property="gbDgsPrice" column="gb_dgs_price"/>
        <result property="gbDgsWeight" column="gb_dgs_weight"/>
        <result property="gbDgsSubtotal" column="gb_dgs_subtotal"/>
        <result property="gbDgsRestWeight" column="gb_dgs_rest_weight"/>
        <result property="gbDgsRestSubtotal" column="gb_dgs_rest_subtotal"/>
        <result property="gbDgsProduceWeight" column="gb_dgs_produce_weight"/>
        <result property="gbDgsProduceSubtotal" column="gb_dgs_produce_subtotal"/>
        <result property="gbDgsGbDepartmentId" column="gb_dgs_gb_department_id"/>
        <result property="gbDgsGbDepartmentFatherId" column="gb_dgs_department_father_id"/>
        <result property="gbDgsStatus" column="gb_dgs_status"/>
        <result property="gbDgsReceiveUserId" column="gb_dgs_receive_user_id"/>
        <result property="gbDgsGbDistributerId" column="gb_dgs_gb_distributer_id"/>
        <result property="gbDgsGbGoodsStockId" column="gb_dgs_gb_goods_stock_id"/>
        <result property="gbDgsDate" column="gb_dgs_date"/>
        <result property="gbDgsWarnFullTime" column="gb_dgs_warn_full_time"/>
        <result property="gbDgsWasteFullTime" column="gb_dgs_waste_full_time"/>
        <result property="gbDgsFullTime" column="gb_dgs_full_time"/>
        <result property="gbDgsDoWasteFullTime" column="gb_dgs_do_waste_full_time"/>
        <result property="gbDgsLossWeight" column="gb_dgs_loss_weight"/>
        <result property="gbDgsLossSubtotal" column="gb_dgs_loss_subtotal"/>
        <result property="gbDgsReturnWeight" column="gb_dgs_return_weight"/>
        <result property="gbDgsReturnSubtotal" column="gb_dgs_return_subtotal"/>
        <result property="gbDgsWarnTimeQuantumName" column="gb_dgs_warn_time_quantum_name"/>
        <result property="gbDgsWasteTimeQuantumName" column="gb_dgs_waste_time_quantum_name"/>
        <result property="gbDgsGbPurGoodsId" column="gb_dgs_gb_pur_goods_id"/>
        <result property="gbDgsGbPurGoodsId" column="from_gb_dgs_gb_pur_goods_id"/>
        <result property="gbDgsGbPriceGoodsId" column="from_gb_dgs_gb_price_goods_id"/>
    </resultMap>

    <resultMap id="applys" type="GbDepartmentOrdersEntity">
        <id property="gbDepartmentOrdersId" column="gb_department_orders_id"/>
        <result property="gbDoSellingPrice" column="gb_DO_selling_price"/>
        <result property="gbDoSellingSubtotal" column="gb_DO_selling_subtotal"/>
        <result property="gbDoBillId" column="gb_DO_bill_id"/>
        <result property="gbDoNxGoodsId" column="gb_DO_nx_goods_id"/>
        <result property="gbDoOrderUserId" column="gb_DO_order_user_id"/>
        <result property="gbDoApplyDate" column="gb_DO_apply_date"/>
        <result property="gbDoApplyOnlyTime" column="gb_DO_apply_only_time"/>
        <result property="gbDoApplyFullTime" column="gb_DO_apply_full_time"/>
        <result property="gbDoArriveOnlyDate" column="gb_DO_arrive_only_date"/>
        <result property="gbDoArriveDate" column="gb_DO_arrive_date"/>
        <result property="gbDoArriveWhatDay" column="gb_DO_arrive_what_day"/>
        <result property="gbDoQuantity" column="gb_DO_quantity"/>
        <result property="gbDoStandard" column="gb_DO_standard"/>
        <result property="gbDoDsStandardScale" column="gb_DO_ds_standard_scale"/>
        <result property="gbDoDsStandardId" column="gb_DO_ds_standard_id"/>
        <result property="gbDoRemark" column="gb_DO_remark"/>
        <result property="gbDoStatus" column="gb_DO_status"/>
        <result property="gbDoWeight" column="gb_DO_weight"/>
        <result property="gbDoScaleWeight" column="gb_DO_scale_weight"/>
        <result property="gbDoScalePrice" column="gb_DO_scale_price"/>
        <result property="gbDoPrice" column="gb_DO_price"/>
        <result property="gbDoSubtotal" column="gb_DO_subtotal"/>
        <result property="gbDoBuyStatus" column="gb_DO_buy_status"/>
        <result property="gbDoNxGoodsFatherId" column="gb_DO_nx_goods_father_id"/>
        <result property="gbDoDepartmentFatherId" column="gb_DO_department_father_id"/>
        <result property="gbDoDisGoodsId" column="gb_DO_dis_goods_id"/>
        <result property="gbDoDepDisGoodsId" column="gb_DO_dep_dis_goods_id"/>
        <result property="gbDoDisGoodsFatherId" column="gb_DO_dis_goods_father_id"/>
        <result property="gbDoDepartmentId" column="gb_DO_department_id"/>
        <result property="gbDoDistributerId" column="gb_DO_distributer_id"/>
        <result property="gbDoBuyStatus" column="gb_DO_buy_status"/>
        <result property="gbDoGoodsType" column="gb_DO_goods_type"/>
        <result property="gbDoDgsrReturnId" column="gb_DO_dgsr_return_id"/>
        <result property="gbDoOperationTime" column="gb_DO_operation_time"/>
        <result property="gbDoIsAgent" column="gb_DO_is_agent"/>
        <result property="gbDoPurchaseGoodsId" column="gb_DO_purchase_goods_id"/>
        <result property="gbDoDepDisGoodsId" column="gb_DO_dep_dis_goods_id"/>
        <result property="gbDoGoodsType" column="gb_DO_goods_type"/>
        <result property="gbDoDgsrReturnId" column="gb_DO_dgsr_return_id"/>
        <result property="gbDoNxDepartmentOrderId" column="gb_DO_nx_department_order_id"/>
        <result property="gbDoNxDistributerId" column="gb_DO_distributer_id"/>
        <result property="gbDoNxDistributerGoodsId" column="gb_DO_nx_distributer_goods_id"/>
        <result property="gbDoToDepartmentId" column="gb_DO_to_department_id"/>
        <result property="gbDoOrderType" column="gb_DO_order_type"/>
        <result property="gbDoReceiveUserId" column="gb_DO_return_user_id"/>
        <result property="gbDoPurchaseUserId" column="gb_DO_purchase_user_id"/>
        <result property="gbDoReceiveUserId" column="gb_DO_return_user_id"/>
        <result property="gbDoWeightTotalId" column="gb_DO_weight_total_id"/>
        <result property="gbDoWeightGoodsId" column="gb_DO_weight_goods_id"/>
        <result property="gbDoPriceDifferent" column="gb_DO_price_different"/>
        <association property="gbDistributerGoodsEntity" resultMap="disGoods"/>
        <collection property="goodsStockEntityList" resultMap="depStock"/>
    </resultMap>
    <resultMap id="issueUser" type="GbDepartmentUserEntity">
        <id property="gbDepartmentUserId" column="gb_department_user_id"/>
		<result property="gbDuLoginTimes" column="gb_DU_login_times"/>
        <result property="gbDuCustomerService" column="gb_DU_customer_service"/>
        <result property="gbDuDepartmentId" column="gb_DU_department_id"/>
        <result property="gbDuDepartmentFatherId" column="gb_DU_department_father_id"/>
        <result property="gbDuWxNickName" column="gb_DU_wx_nick_name"/>
        <result property="gbDuWxAvartraUrl" column="gb_DU_wx_avartra_url"/>
        <result property="gbDuUrlChange" column="gb_DU_url_change"/>
        <result property="gbDuWxOpenId" column="gb_DU_wx_open_id"/>
        <result property="gbDuDistributerId" column="gb_DU_distributer_id"/>
        <result property="gbDuAdmin" column="gb_DU_admin"/>
        <result property="gbDuJoinDate" column="gb_DU_join_date"/>
        <result property="gbDuPrintDeviceId" column="gb_DU_print_device_id"/>
        <result property="gbDuPrintBillDeviceId" column="gb_DU_print_bill_device_id"/>
    </resultMap>

    <resultMap id="billDetail" type="GbDepartmentBillEntity">
        <id property="gbDepartmentBillId" column="gb_department_bill_id"/>
        <result property="gbDbSellingTotal" column="gb_DB_selling_total"/>
        <result property="gbDbDate" column="gb_DB_date"/>
        <result property="gbDbDepId" column="gb_DB_dep_id"/>
        <result property="gbDbIssueDepId" column="gb_DB_issue_dep_id"/>
        <result property="gbDbIssueUserId" column="gb_DB_issue_user_id"/>
        <result property="gbDbDisId" column="gb_DB_dis_id"/>
        <result property="gbDbPrintTimes" column="gb_DB_print_times"/>
        <result property="gbDbStatus" column="gb_DB_status"/>
        <result property="gbDbTotal" column="gb_DB_total"/>
        <result property="gbDbTime" column="gb_DB_time"/>
        <result property="gbDbTradeNo" column="gb_DB_trade_no"/>
        <result property="gbDbWeek" column="gb_DB_week"/>
        <result property="gbDbOrderAmount" column="gb_DB_order_amount"/>
        <result property="gbDbIssueOrderType" column="gb_DB_issue_order_type"/>
        <result property="gbDbIssueNxDisId" column="gb_DB_issue_nx_dis_id"/>
        <association property="gbDepartmentEntity" resultMap="fatherDep"/>
        <association property="issueDepartmentEntity" resultMap="issueDep"/>
        <association property="issueUserEntity" resultMap="issueUser"/>
        <collection property="gbDepartmentOrdersEntities" resultMap="applys"/>
    </resultMap>

    <resultMap id="billDetailWithApplys" type="GbDepartmentBillEntity">
        <id property="gbDepartmentBillId" column="gb_department_bill_id"/>
        <result property="gbDbSellingTotal" column="gb_DB_selling_total"/>
        <result property="gbDbDate" column="gb_DB_date"/>
        <result property="gbDbDepId" column="gb_DB_dep_id"/>
        <result property="gbDbIssueDepId" column="gb_DB_issue_dep_id"/>
        <result property="gbDbIssueUserId" column="gb_DB_issue_user_id"/>
        <result property="gbDbDisId" column="gb_DB_dis_id"/>
        <result property="gbDbPrintTimes" column="gb_DB_print_times"/>
        <result property="gbDbStatus" column="gb_DB_status"/>
        <result property="gbDbTotal" column="gb_DB_total"/>
        <result property="gbDbTime" column="gb_DB_time"/>
        <result property="gbDbTradeNo" column="gb_DB_trade_no"/>
        <result property="gbDbWeek" column="gb_DB_week"/>
        <result property="gbDbOrderAmount" column="gb_DB_order_amount"/>
        <result property="gbDbIssueOrderType" column="gb_DB_issue_order_type"/>
        <association property="gbDepartmentEntity" resultMap="fatherDep"/>
        <association property="issueDepartmentEntity" resultMap="issueDep"/>
        <association property="issueUserEntity" resultMap="issueUser"/>
<!--        <collection property="gbDepartmentOrdersEntities" resultMap="applys"/>-->
    </resultMap>


    <select id="queryGbDepartmentBillDetail" resultMap="billDetail">
        select *,
               toDep.gb_department_id   'gb_department_id',
               toDep.gb_department_name 'gb_department_name',
               dep.gb_department_id     'f_gb_department_id',
               dep.gb_department_name   'f_gb_department_name',
               dep.gb_department_dis_id 'f_gb_department_dis_id'

        from gb_department_bill as db
                 left join gb_department_orders as dor on dor.gb_DO_bill_id = db.gb_department_bill_id
                 left join gb_distributer_goods as gdg on gdg.gb_distributer_goods_id = dor.gb_DO_dis_goods_id
                 left join gb_department as toDep on toDep.gb_department_id = db.gb_DB_issue_dep_id
                 left join gb_department as dep on dep.gb_department_id = db.gb_DB_dep_id
                 left join gb_department_user as issueUser on issueUser.gb_department_user_id = db.gb_DB_issue_user_id
                 left join gb_department_goods_stock as gdgs
                           on gdgs.gb_dgs_gb_department_order_id = dor.gb_department_orders_id

        where gb_department_bill_id = #{billId}
    </select>

    <!---->
    <select id="queryBillsByParamsGb" resultMap="billDetailWithApplys">
        select * ,
        toDep.gb_department_id 'gb_department_id',
        toDep.gb_department_name 'gb_department_name',
        toDep.gb_department_attr_name 'gb_department_attr_name',
        dep.gb_department_id 'f_gb_department_id',
        dep.gb_department_name 'f_gb_department_name',
        dep.gb_department_attr_name 'f_gb_department_attr_name',
        dep.gb_department_dis_id 'f_gb_department_dis_id'
        from gb_department_bill as gb
        left join gb_department as toDep on toDep.gb_department_id = gb.gb_DB_issue_dep_id
        left join gb_department as dep on dep.gb_department_id = gb.gb_DB_dep_id
        left join gb_department_user as issueUser on issueUser.gb_department_user_id = gb.gb_DB_issue_user_id

        <where>
            <if test="disId != null">
                and gb_DB_dis_id = #{disId}
            </if>
            <if test="nxDisId != null">
                and gb.gb_DB_issue_nx_dis_id = #{nxDisId}
            </if>

            <if test="depId != null">
                and gb_DB_dep_id = #{depId}
            </if>
            <if test="issueDepId != null">
                and gb_DB_issue_dep_id = #{issueDepId}
            </if>
            <if test="issueType != null">
                and gb_DB_issue_order_type = #{issueType}
            </if>

            <if test="issueUserId != null">
                and gb_DB_issue_user_id = #{issueUserId}
            </if>
            <if test="status != null">
                and gb_DB_status &lt; #{status}
            </if>
            <if test="dayuStatus != null ">
                and gb_DB_status &gt; #{dayuStatus}
            </if>
            <if test="equalStatus != null ">
                and gb_DB_status = #{equalStatus}
            </if>
            <if test="month != null ">
                and gb_DB_month = #{month}
            </if>

            <if test="date != null ">
                and gb_DB_date = #{date}
            </if>
            <if test="startDate != null ">
                and gb_DB_date &gt;= #{startDate}
            </if>
            <if test="stopDate != null ">
                and gb_DB_date &lt;= #{stopDate}
            </if>
            <if test="admin != null ">
                and gb_DB_issue_order_type = #{admin}
            </if>

            <if test="orderType != null ">
                and gb_DB_issue_order_type = #{orderType}
            </if>

            <if test="payId != null ">
                and gb_DB_gb_supplier_payment_id = #{payId}
            </if>
            <if test="settleId != null and settleId == -1">
                and gb_DB_dep_settle_id is null
            </if>
            <if test="orderTypes != null">
                and gb_DB_issue_order_type in
                <foreach item="orderType" collection="orderTypes" open="(" separator="," close=")">
                    #{orderType}
                </foreach>
            </if>
        </where>
        order by gb_DB_time DESC
    </select>


    <select id="queryTotalByParamsGb" resultType="java.lang.Integer">
        select count(*) from gb_department_bill
        <where>
            <if test="depId != null ">
                and gb_DB_dep_id = #{depId}
            </if>
            <if test="issueType != null">
                and gb_DB_issue_order_type = #{issueType}
            </if>
            <if test="depId != null">
                and gb_DB_dep_id = #{depId}
            </if>
            <if test="disId != null ">
                and gb_DB_dis_id = #{disId}
            </if>
            <if test="month != null ">
                and gb_DB_month = #{month}
            </if>
            <if test="status != null ">
                and gb_DB_status &lt; #{status}
            </if>
            <if test="date != null ">
                and gb_DB_date = #{date}
            </if>
            <if test="startDate != null ">
                and gb_DB_date &gt;= #{startDate}
            </if>
            <if test="stopDate != null ">
                and gb_DB_date &lt;= #{stopDate}
            </if>
            <if test="equalStatus != null ">
                and gb_DB_status = #{equalStatus}
            </if>
            <if test="dayuStatus != null ">
                and gb_DB_status &gt; #{dayuStatus}
            </if>
            <if test="orderType != null ">
                and gb_DB_issue_order_type = #{orderType}
            </if>
            <if test="orderTypes != null">
                and gb_DB_issue_order_type in
                <foreach item="orderType" collection="orderTypes" open="(" separator="," close=")">
                    #{orderType}
                </foreach>
            </if>
        </where>
    </select>
    <select id="queryBillsCountByParamsGb" resultType="java.lang.Integer">
        select count(*) from gb_department_bill
        <where>
            <if test="issueDepId != null">
                and gb_DB_issue_dep_id = #{issueDepId}
            </if>
            <if test="issueType != null">
                and gb_DB_issue_order_type = #{issueType}
            </if>
            <if test="depId != null">
                and gb_DB_dep_id = #{depId}
            </if>
            <if test="equalStatus != null">
                and gb_DB_status = #{equalStatus}
            </if>
            <if test="status != null">
                and gb_DB_status &lt; #{status}
            </if>
            <if test="date != null ">
                and gb_DB_date = #{date}
            </if>
            <if test="startDate != null ">
                and gb_DB_date &gt;= #{startDate}
            </if>
            <if test="stopDate != null ">
                and gb_DB_date &lt;= #{stopDate}
            </if>
            <if test="dayuStatus != null">
                and gb_DB_status &gt; #{dayuStatus}
            </if>
            <if test="orderType != null">
                and gb_DB_issue_order_type = #{orderType}
            </if>
            <if test="orderTypes != null">
                and gb_DB_issue_order_type in
                <foreach item="orderType" collection="orderTypes" open="(" separator="," close=")">
                    #{orderType}
                </foreach>
            </if>

        </where>
    </select>
    <select id="queryGbDepBillsSubTotal" resultType="java.lang.Double">
        select sum(gb_DB_total) from gb_department_bill
        <where>
            <if test="depId != null">
                and gb_DB_dep_id = #{depId}
            </if>
            <if test="issueDepId != null">
                and gb_DB_issue_dep_id = #{issueDepId}
            </if>
            <if test="issueType != null">
                and gb_DB_issue_order_type = #{issueType}
            </if>
            <if test="andIssueType != null">
                and gb_DB_issue_order_type = #{andIssueType}
            </if>

            <if test="disId != null">
                and gb_DB_dis_id = #{disId}
            </if>
            <if test="nxDisId != null">
                and gb_DB_issue_nx_dis_id = #{nxDisId}
            </if>
            <if test="status != null">
                and gb_DB_status &lt; #{status}
            </if>
            <if test="date != null ">
                and gb_DB_date = #{date}
            </if>
            <if test="startDate != null ">
                and gb_DB_date &gt;= #{startDate}
            </if>
            <if test="stopDate != null ">
                and gb_DB_date &lt;= #{stopDate}
            </if>
            <if test="dayuStatus != null ">
                and gb_DB_status &gt; #{dayuStatus}
            </if>
            <if test="equalStatus != null ">
                and gb_DB_status = #{equalStatus}
            </if>
            <if test="month != null ">
                and gb_DB_month = #{month}
            </if>
            <if test="orderType != null ">
                and gb_DB_issue_order_type = #{orderType}
            </if>
            <if test="orderTypes != null">
                and gb_DB_issue_order_type in
                <foreach item="orderType" collection="orderTypes" open="(" separator="," close=")">
                    #{orderType}
                </foreach>
            </if>
            <if test="settleId != null and settleId == -1">
                and gb_DB_dep_settle_id is null
            </if>

        </where>
    </select>


    <select id="queryDepartmentBillList" resultMap="billDetail">
        select * from gb_department_bill as gdb
        left join gb_department_orders as gdo on gdo.gb_DO_bill_id = gdb.gb_department_bill_id
        left join gb_distributer_goods as gdg on gdg.gb_distributer_goods_id = gdo.gb_DO_dis_goods_id
        <where>
            <if test="userId != null">
                and gb_DB_issue_user_id = #{userId}
            </if>

            <if test="depId != null">
                and gb_DB_dep_id = #{depId}
            </if>
            <if test="issueDepId != null">
                and gb_DB_issue_dep_id = #{issueDepId}
            </if>
            <if test="issueType != null">
                and gb_DB_issue_order_type = #{issueType}
            </if>
            <if test="disId != null">
                and gb_DB_dis_id = #{disId}
            </if>
            <if test="nxDisId != null">
                and gb_DB_issue_nx_dis_id = #{nxDisId}
            </if>
            <if test="status != null">
                and gb_DB_status &lt; #{status}
            </if>
            <if test="date != null ">
                and gb_DB_date = #{date}
            </if>
            <if test="willDate != null ">
                and gb_DB_will_pay_date = #{willDate}
            </if>
            <if test="startDate != null ">
                and gb_DB_date &gt;= #{startDate}
            </if>
            <if test="stopDate != null ">
                and gb_DB_date &lt;= #{stopDate}
            </if>
            <if test="dayuStatus != null ">
                and gb_DB_status &gt; #{dayuStatus}
            </if>
            <if test="equalStatus != null ">
                and gb_DB_status = #{equalStatus}
            </if>

            <if test="orderType != null ">
                and gb_DB_issue_order_type = #{orderType}
            </if>
            <if test="orderTypes != null">
                and gb_DB_issue_order_type in
                <foreach item="orderType" collection="orderTypes" open="(" separator="," close=")">
                    #{orderType}
                </foreach>
            </if>
            <if test="month != null ">
                and gb_DB_month = #{month}
            </if>
            <if test="settleId != null and settleId == -1">
                and gb_DB_dep_settle_id is null
            </if>
        </where>
    </select>
    <select id="queryGbDepBillsSellingSubTotal" resultType="java.lang.Double">
        select sum(gb_DB_selling_total) from gb_department_bill
        <where>
            <if test="depId != null">
                and gb_DB_dep_id = #{depId}
            </if>
            <if test="issueDepId != null">
                and gb_DB_issue_dep_id = #{issueDepId}
            </if>
            <if test="issueType != null">
                and gb_DB_issue_order_type = #{issueType}
            </if>
            <if test="disId != null">
                and gb_DB_dis_id = #{disId}
            </if>
            <if test="nxDisId != null">
                and gb_DB_issue_nx_dis_id = #{nxDisId}
            </if>
            <if test="date != null ">
                and gb_DB_date = #{date}
            </if>
            <if test="startDate != null ">
                and gb_DB_date &gt;= #{startDate}
            </if>
            <if test="stopDate != null ">
                and gb_DB_date &lt;= #{stopDate}
            </if>
            <if test="status != null">
                and gb_DB_status &lt; #{status}
            </if>
            <if test="dayuStatus != null ">
                and gb_DB_status &gt; #{dayuStatus}
            </if>
            <if test="equalStatus != null ">
                and gb_DB_status = #{equalStatus}
            </if>
            <if test="month != null ">
                and gb_DB_month = #{month}
            </if>
            <if test="orderType != null ">
                and gb_DB_issue_order_type = #{orderType}
            </if>
            <if test="orderTypes != null">
                and gb_DB_issue_order_type in
                <foreach item="orderType" collection="orderTypes" open="(" separator="," close=")">
                    #{orderType}
                </foreach>
            </if>
            <if test="settleId != null and settleId == -1">
                and gb_DB_dep_settle_id is null
            </if>

        </where>
    </select>
    <select id="queryDepartmentBillCount" resultType="java.lang.Integer">
        select COUNT(*) from gb_department_bill
        <where>
            <if test="depId != null">
                and gb_DB_dep_id = #{depId}
            </if>
            <if test="issueDepId != null">
                and gb_DB_issue_dep_id = #{issueDepId}
            </if>
            <if test="issueType != null">
                and gb_DB_issue_order_type = #{issueType}
            </if>
            <if test="andIssueType != null">
                and gb_DB_issue_order_type = #{andIssueType}
            </if>
            <if test="disId != null">
                and gb_DB_dis_id = #{disId}
            </if>
            <if test="nxDisId != null">
                and gb_DB_issue_nx_dis_id = #{nxDisId}
            </if>
            <if test="status != null">
                and gb_DB_status &lt; #{status}
            </if>
            <if test="dayuStatus != null ">
                and gb_DB_status &gt; #{dayuStatus}
            </if>
            <if test="equalStatus != null ">
                and gb_DB_status = #{equalStatus}
            </if>
            <if test="date != null ">
                and gb_DB_date = #{date}
            </if>
            <if test="startDate != null ">
                and gb_DB_date &gt;= #{startDate}
            </if>
            <if test="stopDate != null ">
                and gb_DB_date &lt;= #{stopDate}
            </if>
            <if test="month != null ">
                and gb_DB_month = #{month}
            </if>
            <if test="settleId != null and settleId == -1">
                and gb_DB_dep_settle_id is null
            </if>
            <if test="orderType != null ">
                and gb_DB_issue_order_type = #{orderType}
            </if>
            <if test="orderTypes != null">
                and gb_DB_issue_order_type in
                <foreach item="orderType" collection="orderTypes" open="(" separator="," close=")">
                    #{orderType}
                </foreach>
            </if>

        </where>
    </select>
    <resultMap id="applysWithStock" type="GbDepartmentOrdersEntity">
        <id property="gbDepartmentOrdersId" column="gb_department_orders_id"/>
        <result property="gbDoSellingPrice" column="gb_DO_selling_price"/>
        <result property="gbDoSellingSubtotal" column="gb_DO_selling_subtotal"/>
        <result property="gbDoApplyDate" column="gb_DO_apply_date"/>
        <result property="gbDoApplyArriveDate" column="gb_DO_apply_arrive_date"/>
        <result property="gbDoArriveOnlyDate" column="gb_DO_arrive_only_date"/>
        <result property="gbDoApplyFullTime" column="gb_DO_apply_full_time"/>
        <result property="gbDoApplyOnlyTime" column="gb_DO_apply_only_time"/>
        <result property="gbDoQuantity" column="gb_DO_quantity"/>
        <result property="gbDoStandard" column="gb_DO_standard"/>
        <result property="gbDoDsStandardId" column="gb_DO_ds_standard_id"/>
        <result property="gbDoDsStandardScale" column="gb_DO_ds_standard_scale"/>
        <result property="gbDoRemark" column="gb_DO_remark"/>
        <result property="gbDoStatus" column="gb_DO_status"/>
        <result property="gbDoWeight" column="gb_DO_weight"/>
        <result property="gbDoScaleWeight" column="gb_DO_scale_weight"/>
        <result property="gbDoScalePrice" column="gb_DO_scale_price"/>
        <result property="gbDoPrice" column="gb_DO_price"/>
        <result property="gbDoSubtotal" column="gb_DO_subtotal"/>
        <result property="gbDoBuyStatus" column="gb_DO_buy_status"/>
        <result property="gbDoPurchaseGoodsId" column="gb_DO_purchase_goods_id"/>
        <result property="gbDoArriveWhatDay" column="gb_DO_arrive_what_day"/>
        <result property="gbDoArriveWeeksYear" column="gb_DO_arrive_weeks_year"/>
        <result property="gbDoOrderType" column="gb_DO_order_type"/>
        <result property="gbDoBillId" column="gb_DO_bill_id"/>
        <result property="gbDoReceiveUserId" column="gb_DO_receive_user_id"/>
        <result property="gbDoPurchaseUserId" column="gb_DO_purchase_user_id"/>
        <result property="gbDoReceiveUserId" column="gb_DO_return_user_id"/>
        <result property="gbDoWeightTotalId" column="gb_DO_weight_total_id"/>
        <result property="gbDoWeightGoodsId" column="gb_DO_weight_goods_id"/>
        <result property="gbDoPriceDifferent" column="gb_DO_price_different"/>
        <collection property="goodsStockEntityList" resultMap="depStock"/>
    </resultMap>
    <resultMap id="billSearchGoods" type="GbDepartmentBillEntity">
        <id property="gbDepartmentBillId" column="gb_department_bill_id"/>
        <result property="gbDbSellingTotal" column="gb_DB_selling_total"/>
        <result property="gbDbDate" column="gb_DB_date"/>
        <result property="gbDbDepId" column="gb_DB_dep_id"/>
        <result property="gbDbIssueDepId" column="gb_DB_issue_dep_id"/>
        <result property="gbDbIssueUserId" column="gb_DB_issue_user_id"/>
        <result property="gbDbDisId" column="gb_DB_dis_id"/>
        <result property="gbDbPrintTimes" column="gb_DB_print_times"/>
        <result property="gbDbStatus" column="gb_DB_status"/>
        <result property="gbDbTotal" column="gb_DB_total"/>
        <result property="gbDbTime" column="gb_DB_time"/>
        <result property="gbDbTradeNo" column="gb_DB_trade_no"/>
        <result property="gbDbWeek" column="gb_DB_week"/>
        <result property="gbDbOrderAmount" column="gb_DB_order_amount"/>
        <result property="gbDbIssueOrderType" column="gb_DB_issue_order_type"/>
        <association property="gbDepartmentEntity" resultMap="fatherDep"/>
        <association property="issueDepartmentEntity" resultMap="issueDep"/>
        <association property="issueUserEntity" resultMap="issueUser"/>
        <collection property="gbDepartmentOrdersEntities" resultMap="applysWithStock"/>

    </resultMap>
    <select id="queryBillGoodsByParams" resultMap="billSearchGoods">
        select * from gb_department_bill as gdb
        left join gb_department_orders as gdo on gdo.gb_DO_bill_id = gdb.gb_department_bill_id
        left join gb_department_dis_goods as gddg on gddg.gb_department_dis_goods_id = gdo.gb_DO_dep_dis_goods_id
        left join gb_distributer_goods as gdg on gdg.gb_distributer_goods_id = gddg.gb_DDG_dis_goods_id
        left join gb_department_goods_stock as gdgs on gdgs.gb_dgs_gb_department_order_id = gdo.gb_department_orders_id
        <where>
            <if test="depGoodsId != null">
                and gdo.gb_DO_dep_dis_goods_id = #{depGoodsId}
            </if>
            <if test="startDate != null">
                and gdo.gb_DO_arrive_date &gt;= #{startDate}
            </if>

            <if test="stopDate != null">
                and gdo.gb_DO_arrive_date &lt;= #{stopDate}
            </if>
            <if test="orderType != null ">
                and gb_DB_issue_order_type = #{orderType}
            </if>
            <if test="orderTypes != null">
                and gb_DB_issue_order_type in
                <foreach item="orderType" collection="orderTypes" open="(" separator="," close=")">
                    #{orderType}
                </foreach>
            </if>
        </where>

    </select>
    <select id="queryDepartBillByTradeNo" resultType="com.nongxinle.entity.GbDepartmentBillEntity">
        select * from gb_department_bill where gb_DB_wx_out_trade_no = #{ordersSn}
    </select>

<!--    <select id="queryDepartBillListByTradeNo" resultType="com.nongxinle.entity.GbDepartmentBillEntity">-->
<!--        select * from gb_department_bill where  gb_DB_wx_out_trade_no = #{ordersSn}-->
<!--    </select>-->
    <select id="queryDepartBillByTsxTradeNo" resultType="com.nongxinle.entity.GbDepartmentBillEntity">
        select * from gb_department_bill where gb_DB_trade_no = #{nxDbTradeNo}
    </select>


    <insert id="save" parameterType="com.nongxinle.entity.GbDepartmentBillEntity"
            useGeneratedKeys="true" keyProperty="gbDepartmentBillId">
        insert into gb_department_bill
        (`gb_department_bill_id`,
         `gb_DB_dis_id`,
         `gb_DB_dep_id`,
         `gb_DB_total`,
         `gb_DB_status`,
         `gb_DB_time`,
         `gb_DB_issue_user_id`,
         `gb_DB_date`,
         `gb_DB_will_pay_date`,
         `gb_DB_month`,
         `gb_DB_week`,
         `gb_DB_trade_no`,
         `gb_DB_print_times`,
         `gb_DB_day`,
         `gb_DB_issue_order_type`,
         `gb_DB_issue_dep_id`,
         `gb_DB_order_amount`,
         `gb_DB_confirm_goods_user_id`,
         `gb_DB_confirm_price_user_id`,
         `gb_DB_confirm_settle_user_id`,
         `gb_DB_confirm_goods_time`,
         `gb_DB_confirm_price_time`,
         `gb_DB_confirm_settle_time`,
         `gb_DB_dep_settle_id`,
         `gb_DB_issue_nx_dis_id`,
         `gb_DB_selling_total`,
         `gb_DB_gb_supplier_payment_id`,
         `gb_DB_wx_out_trade_no`
         )
        values (#{gbDepartmentBillId},
                #{gbDbDisId},
                #{gbDbDepId},
                #{gbDbTotal},
                #{gbDbStatus},
                #{gbDbTime},
                #{gbDbIssueUserId},
                #{gbDbDate},
                #{gbDbWillPayDate},
                #{gbDbMonth},
                #{gbDbWeek},
                #{gbDbTradeNo},
                #{gbDbPrintTimes},
                #{gbDbDay},
                #{gbDbIssueOrderType},
                #{gbDbIssueDepId},
                #{gbDbOrderAmount},
                #{gbDbConfirmGoodsUserId},
                #{gbDbConfirmPriceUserId},
                #{gbDbConfirmSettleUserId},
                #{gbDbConfirmGoodsTime},
                #{gbDbConfirmPriceTime},
                #{gbDbConfirmSettleTime},
                #{gbDbDepSettleId},
                #{gbDbIssueNxDisId},
                #{gbDbSellingTotal},
                #{gbDbGbSupplierPaymentId},
                #{gbDbWxOutTradeNo}
                )
    </insert>

    <update id="update" parameterType="com.nongxinle.entity.GbDepartmentBillEntity">
        update gb_department_bill
        <set>
            <if test="gbDbDisId != null">`gb_DB_dis_id` = #{gbDbDisId},</if>
            <if test="gbDbDepId != null">`gb_DB_dep_id` = #{gbDbDepId},</if>
            <if test="gbDbTotal != null">`gb_DB_total` = #{gbDbTotal},</if>
            <if test="gbDbStatus != null">`gb_DB_status` = #{gbDbStatus},</if>
            <if test="gbDbTime != null">`gb_DB_time` = #{gbDbTime},</if>
            <if test="gbDbIssueUserId != null">`gb_DB_issue_user_id` = #{gbDbIssueUserId},</if>
            <if test="gbDbDate != null">`gb_DB_date` = #{gbDbDate},</if>
            <if test="gbDbWillPayDate != null">`gb_DB_will_pay_date` = #{gbDbWillPayDate},</if>
            <if test="gbDbMonth != null">`gb_DB_month` = #{gbDbMonth},</if>
            <if test="gbDbWeek != null">`gb_DB_week` = #{gbDbWeek},</if>
            <if test="gbDbTradeNo != null">`gb_DB_trade_no` = #{gbDbTradeNo},</if>
            <if test="gbDbPrintTimes != null">`gb_DB_print_times` = #{gbDbPrintTimes},</if>
            <if test="gbDbIssueOrderType != null">`gb_DB_issue_order_type` = #{gbDbIssueOrderType},</if>
            <if test="gbDbIssueDepId != null">`gb_DB_issue_dep_id` = #{gbDbIssueDepId},</if>
            <if test="gbDbOrderAmount != null">`gb_DB_order_amount` = #{gbDbOrderAmount},</if>
            <if test="gbDbConfirmGoodsUserId != null">`gb_DB_confirm_goods_user_id` = #{gbDbConfirmGoodsUserId},</if>
            <if test="gbDbConfirmPriceUserId != null">`gb_DB_confirm_price_user_id` = #{gbDbConfirmPriceUserId},</if>
            <if test="gbDbConfirmSettleUserId != null">`gb_DB_confirm_settle_user_id` = #{gbDbConfirmSettleUserId},</if>
            <if test="gbDbConfirmGoodsTime != null">`gb_DB_confirm_goods_time` = #{gbDbConfirmGoodsTime},</if>
            <if test="gbDbConfirmPriceTime != null">`gb_DB_confirm_price_time` = #{gbDbConfirmPriceTime},</if>
            <if test="gbDbConfirmSettleTime != null">`gb_DB_confirm_settle_time` = #{gbDbConfirmSettleTime},</if>
            <if test="gbDbDepSettleId != null">`gb_DB_dep_settle_id` = #{gbDbDepSettleId},</if>
            <if test="gbDbIssueNxDisId != null">`gb_DB_issue_nx_dis_id` = #{gbDbIssueNxDisId},</if>
            <if test="gbDbSellingTotal != null">`gb_DB_selling_total` = #{gbDbSellingTotal},</if>
            <if test="gbDbGbSupplierPaymentId != null">`gb_DB_gb_supplier_payment_id` = #{gbDbGbSupplierPaymentId},</if>
            <if test="gbDbWxOutTradeNo != null">`gb_DB_wx_out_trade_no` = #{gbDbWxOutTradeNo},</if>
            <if test="gbDbDay != null">`gb_DB_day` = #{gbDbDay}</if>
        </set>
        where gb_department_bill_id = #{gbDepartmentBillId}
    </update>

    <delete id="delete">
        delete
        from gb_department_bill
        where gb_department_bill_id = #{value}
    </delete>

    <delete id="deleteBatch">
        delete from gb_department_bill where gb_department_bill_id in
        <foreach item="gbDepartmentBillId" collection="array" open="(" separator="," close=")">
            #{gbDepartmentBillId}
        </foreach>
    </delete>

</mapper>